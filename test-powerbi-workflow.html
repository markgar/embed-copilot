<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PowerBI Workflow Test</title>
</head>
<body>
    <h1>PowerBI Workflow Test</h1>
    <div id="report-container" style="width: 800px; height: 600px; border: 1px solid #ccc;">
        Loading...
    </div>
    
    <div id="status"></div>

    <!-- PowerBI Scripts -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/powerbi.min.js"></script>
    
    <script type="module">
        // Test PowerBI workflow
        import { initializePowerBI, getFrontendConfig, discoverAndEmbedReport } from '/js/modules/powerbi-core.js';
        import { FabricClient } from '/js/modules/fabric-client.js';

        const status = document.getElementById('status');
        
        function updateStatus(message) {
            console.log(message);
            status.innerHTML += '<br>' + message;
        }

        async function testWorkflow() {
            try {
                updateStatus('üîÑ Starting PowerBI workflow test...');
                
                // Test 1: Get configuration
                updateStatus('üìã Getting frontend configuration...');
                const config = await getFrontendConfig();
                updateStatus(`‚úÖ Config loaded: ${JSON.stringify(config)}`);
                
                // Test 2: Test Fabric client directly
                updateStatus('üîç Testing Fabric client...');
                const fabricClient = new FabricClient();
                const reportResult = await fabricClient.ensureReport(
                    config.powerBIWorkspaceId,
                    config.powerBIDatasetId,
                    config.powerBIDatasetId // Use dataset ID as report name
                );
                updateStatus(`‚úÖ Report ensured: ${JSON.stringify(reportResult)}`);
                
                // Test 3: Try full initialization
                updateStatus('üöÄ Initializing PowerBI...');
                initializePowerBI();
                updateStatus('‚úÖ PowerBI initialization called');
                
            } catch (error) {
                updateStatus(`‚ùå Error: ${error.message}`);
                console.error('Test error:', error);
            }
        }

        // Start the test
        testWorkflow();
    </script>
</body>
</html>