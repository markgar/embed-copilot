name: 'Create Issue for Copilot - Hello Test'

# This workflow can be triggered manually to create an issue for Copilot testing
on:
  workflow_dispatch:
    inputs:
      message:
        description: 'Custom message to include in the issue'
        required: false
        default: 'Hello from the manual test workflow!'
        type: string

# Grant permissions needed to create and assign issues
permissions:
  contents: read
  issues: write

jobs:
  test-copilot-assignment:
    runs-on: ubuntu-latest
    
    steps:
      - name: Create Hello Issue for Copilot
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const currentTime = new Date().toLocaleString();
            
            const issue = await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `ğŸ¤– Copilot Hello Test - ${currentTime}`,
              body: `## ğŸ‘‹ Hello Copilot Test
              
              **Triggered at**: ${currentTime}
              **Workflow run**: ${{ github.run_id }}
              **Custom message**: ${{ inputs.message }}
              
              ---
              
              @github-copilot Hello! ğŸ‘‹
              
              This is a simple proof of concept to test if you can respond to issues.
              
              **Please respond with:**
              1. A simple "Hello" greeting back as a **comment on this issue**
              2. Confirmation that you can see this mention
              3. Any brief comment about this test
              
              That's it! Just add a comment to this issue saying hello - no need to create a PR or make any code changes.
              
              ---
              
              **Test Details:**
              - Repository: ${context.repo.owner}/${context.repo.repo}
              - Workflow: Create Issue for Manual Copilot Assignment
              - Purpose: Test issue creation, then manually assign to Copilot`,
              
              labels: [
                'test',
                'copilot-poc', 
                'automated-issue',
                'hello-world'
              ]
            });
            
            console.log(`âœ… Created test issue #${issue.data.number} for manual Copilot assignment`);
            console.log(`ğŸ”— Issue URL: ${issue.data.html_url}`);
            console.log(`ğŸ¤– Next: Manually assign this issue to Copilot via GitHub UI`);
            console.log(`â° Created at: ${currentTime}`);
            
            // Output the issue URL for easy access
            core.setOutput('issue-url', issue.data.html_url);
            core.setOutput('issue-number', issue.data.number);
            
      - name: Display Results
        run: |
          echo "ğŸ‰ Issue Created Successfully!"
          echo "ğŸ“‹ Issue Number: ${{ steps.test-copilot-assignment.outputs.issue-number }}"
          echo "ğŸ”— Issue URL: ${{ steps.test-copilot-assignment.outputs.issue-url }}"
          echo ""
          echo "âœ‹ MANUAL STEP REQUIRED:"
          echo "1. Visit the issue URL above"
          echo "2. Click on 'Assignees' in the right sidebar"
          echo "3. Assign the issue to 'Copilot' from the dropdown"
          echo ""
          echo "ï¿½ What to look for after assignment:"
          echo "1. Copilot should respond with ğŸ‘€ emoji within seconds"
          echo "2. Copilot should create a draft pull request"
          echo "3. Watch for Copilot to add comments or start working"
          echo ""
          echo "ğŸ“ This tests the full Copilot coding agent workflow!"